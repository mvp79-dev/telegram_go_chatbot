package commands

import (
	"fmt"
	"math/rand"
	"time"

	"github.com/NexonSU/telegram-go-chatbot/utils"
	tele "gopkg.in/telebot.v3"
	"gorm.io/gorm/clause"
)

//Kill user on /blessing, /suicide
func Blessing(context tele.Context) error {
	err := context.Delete()
	if err != nil {
		return err
	}
	ChatMember, err := utils.Bot.ChatMemberOf(context.Chat(), context.Sender())
	if err != nil {
		return err
	}
	if ChatMember.Role == "administrator" || ChatMember.Role == "creator" {
		return context.Send(fmt.Sprintf("<code>üëª %v –≤–æ–∑—Ä–æ–¥–∏–ª—Å—è —É –∫–æ—Å—Ç—Ä–∞.</code>", utils.UserFullName(context.Sender())))
	}
	var duelist utils.Duelist
	result := utils.DB.Model(utils.Duelist{}).Where(context.Sender().ID).First(&duelist)
	if result.RowsAffected == 0 {
		duelist.UserID = context.Sender().ID
		duelist.Kills = 0
		duelist.Deaths = 0
	}
	duelist.Deaths++
	result = utils.DB.Clauses(clause.OnConflict{
		UpdateAll: true,
	}).Create(&duelist)
	if result.Error != nil {
		return result.Error
	}
	duration := utils.RandInt(1, duelist.Deaths+1)
	duration += 10
	prependText := ""
	if utils.RandInt(0, 100) >= 90 {
		duration = duration * 10
		prependText = "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ "
	}
	ChatMember.RestrictedUntil = time.Now().Add(time.Second * time.Duration(60*duration)).Unix()
	err = utils.Bot.Restrict(context.Chat(), ChatMember)
	if err != nil {
		return err
	}
	reason := []string{
		"–≤—ã–±—Ä–∞–ª –ª—ë–≥–∫–∏–π –ø—É—Ç—å",
		"—Å—ã–≥—Ä–∞–ª –≤ —è—â–∏–∫",
		"—Å–ª–∏–ª —Å–≤–æ—ë HP –¥–æ –Ω—É–ª—è",
		"–ø—Ä–∏–∫–∞–∑–∞–ª –¥–æ–ª–≥–æ –∂–∏—Ç—å",
		"–ø–æ–∫–∏–Ω—É–ª —ç—Ç–æ—Ç —Å–∫–æ—Ä–±–Ω—ã–π –º–∏—Ä",
		"–ø–∞–≥–∏–±",
		"—Ä–∞–∑–±–µ–∂–∞–≤—à–∏—Å—å –ø—Ä—ã–≥–Ω—É–ª —Å–æ —Å–∫–∞–ª—ã",
		"—Ä–∞–∑–æ–≥–Ω–∞–ª RTX 4090 Ti",
		"–ø—Ä–∏–Ω—è–ª –∏—Å–ª–∞–º",
		"–ø—å—ë—Ç —á–∞–π –∏ –∫—É—à–æ–µ—Ç –∫–æ–Ω—Ñ–µ—Ç—ã, –Ω–∏–∫–∞–∫–æ–≤–∞ —Å—É–µ—Ü—ã–¥–∞",
		"–Ω–∞–º–æ—Ç–∞–ª—Å—è –Ω–∞ —Å—Ç–æ–ª–±",
		"–ø–æ–º–µ—Ä –≤—ñ–¥ –∫—Ä—ñ–Ω–∂—ñ",
		"–∑–¥–æ—Ö",
		"–∑–∞–ø–ª–∞—Ç–∏–ª, –∞ –±—ã–ª–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ",
		"—É–µ—Ö–∞–ª –≤ –¥—É—Ä–∫—É",
		"–Ω–∞—à—ë–ª —Å–µ–±—è –≤ –ø—Ä–æ—à–º–∞–Ω–¥–æ–≤–∫–∞—Ö –∑–∞–≤—Ç—Ä–∞—á–∞—Ç–∞",
		"—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–ª –ø–∞—Ä—Ç–∏—é, –º–∏–Ω—É—Å 20 —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–µ–¥–∏—Ç –∏ –∫–æ—à–∫–∞–∂–µ–Ω–∞",
		"–¥–æ–Ω—ë—Å –Ω–∞ —Å–∞–º–æ–≥–æ —Å–µ–±—è",
		"–≤—ã–ø–∏–ª –π–∞–¥—É",
		"–ø–∞–ø–∏–ª –≥–µ–π–º–ø–∞—Å—É",
		"–æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –Ω–∞ —Ü—ã–≥–∞–Ω—Å–∫—É—é —Å–≤–∞–¥—å–±—É",
		"–æ—Ç–º–µ–Ω–∏–ª —Å–µ–±—è",
		"–ø–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ —É—Ç–æ—á–∫—É",
		"–ø–æ–≥–∞—Å–∏–ª –µ–±–∞–ª–æ",
		"—Å—ã–≥—Ä–∞–ª –≤ —Å–∞–±–Ω–∞–≤—Ç–∏–∫—É",
		"—É—à—ë–ª –ø–∏—Ç—å –∫–æ–º—Ñ–µ—Ç—ã –∏ –∫—É—à–æ—Ç—å —á–∞–π",
		"—Ö—Ä—è–ø–Ω—É–ª –≤–∏—à–Ω–µ–≤–æ–π –±–∞–ª—Ç–∏–∫–∏",
		"–ø–æ–∏–≥—Ä–∞–ª –≤ –ª–µ–º–º–∏–Ω–≥–æ–≤",
		"—Å—Ç–∞–ª –µ–¥–∏–Ω—ã–º —Å –æ–±–µ–ª–∏—Å–∫–æ–º",
		"–≤—Å—Ç—Ä–µ—Ç–∏–ª –û—Ä–Ω—à—Ç–µ–π–Ω–∞ –∏ –°–º–æ—É–≥–∞",
		"—Å–µ–ª –≤ –ø–æ–µ–∑–¥, –∞ –ø–æ–µ–∑–¥ —Å–¥–µ–ª–∞–ª –±—É–º",
		"—Å—Ç–æ—è–ª –≤ –ª—É–∂–µ –ê–û–ï",
		"–ø–æ–ª—É—á–∏–ª –ø—Ä–∏–≤–µ—Ç –æ—Ç –º–∏—Å—Ç–µ—Ä–∞ –°–∞–ª—å–µ—Ä–∏",
		"–≤ —Å–¥–µ–ª–∫—É –Ω–µ –≤—Ö–æ–¥–∏–ª",
		"–Ω–µ –∑–∞–º–µ—Ç–∏–ª –°–µ—Ñ–∏—Ä–æ—Ç–∞",
		"–º–æ–ª–æ–¥–µ—Ü, –Ω–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ë–µ—Ö–µ–ª–∏—Ç–æ–º",
		"–Ω–µ –≤—ã–ø–ª–∞—Ç–∏–ª –≤–æ–≤—Ä–µ–º—è –¥–æ–ª–≥ –ù—É–∫—É",
		"–±—ã–ª –ø–æ–π–º–∞–Ω –≤–µ–ª–æ—Ü–∏—Ä–∞–ø—Ç–æ—Ä–æ–º",
		"–±—ã–ª —Ä–∞–∑–¥–∞–≤–ª–µ–Ω Metal Gear REX",
		"–∏—Å–µ–∫–∞–π–Ω—É–ª—Å—è",
		"—Å—Ç–∞–ª —Ü–µ–ª—å—é –ê–≥–µ–Ω—Ç–∞ 47",
		"–æ–±–Ω—è–ª –∫—Ä–∏–ø–µ—Ä–∞",
		"—Ä–∞–∑–±–∏–ª –ø—Ä–æ–±–∏—Ä–∫—É —Å –¢-–≤–∏—Ä—É—Å–æ–º",
		"–∑–∞–±–ª—É–¥–∏–ª—Å—è –≤ —Ç—É–º–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ",
		"–∑–∞–±—ã–ª, —á—Ç–æ –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞ –≤ –∂–∏–∑–Ω–∏ –Ω–µ—Ç",
		"—Ä–∞–∑–æ–∑–ª–∏–ª –ö–∏—Ä—é",
		"–ø—Ä–æ–≤–∞–ª–∏–ª—Å—è –ø–æ–¥ –º–∏—Ä",
		"–∑–∞—Å—Ç—Ä—è–ª –≤ –≥–µ–æ–º–µ—Ç—Ä–∏–∏",
		"–≤—Å—Ç—Ä–µ—Ç–∏–ª –≥–µ–π–º–±—Ä–µ–π–∫–∏–Ω–≥ –±–∞–≥",
		"–∂—Ä–∞–ª –∫–∞–ø—É—Å—Ç—É, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—à–∫–∞",
	}
	return context.Send(fmt.Sprintf("<code>üí• %v %v%v.\n–†–µ—Å–ø–∞–≤–Ω —á–µ—Ä–µ–∑ %v –º–∏–Ω.</code>", utils.UserFullName(context.Sender()), prependText, reason[rand.Intn(len(reason))], duration))
}
